webpackJsonp([7],{556:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"ViewpostPageModule",function(){return a});var o=n(0),i=n(16),s=n(590),r=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},a=function(){function e(){}return e=r([Object(o.NgModule)({declarations:[s.a],imports:[i.n.forChild(s.a)],schemas:[o.CUSTOM_ELEMENTS_SCHEMA]})],e)}()},590:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),i=n(16),s=n(90),r=this&&this.__decorate||function(e,t,n,o){var i,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(r=(s<3?i(r):s>3?i(t,n,r):i(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t,n,o,i,s,r){this.navCtrl=e,this.app=t,this.loadingCtrl=n,this.firebaseService=o,this.modalCtrl=i,this.navParams=s,this.viewCtrl=r,this.user=[],this.comments=[],this.loginUser={},this.textLeft=250,this.message="",this.toggled=!1,this.postUser={},this.comment={comment:""},this.heart=!0,this.taggedItem=!1,this.finishedLoading=!1,this.limit=50,this.trackByName=function(e,t){return t.commentid},this.user=this.navParams.get("user")}return e.prototype.ionViewDidLoad=function(){var e=this;this.loggedUser=this.firebaseService.userObject,this.firebaseService.getCommentLastId().snapshotChanges().subscribe(function(t){if(e.arrayLastid=[],t.forEach(function(t){var n=t.payload.toJSON();n.$key=t.key,e.arrayLastid.push(n)}),e.arrayLastid=e.arrayLastid.filter(function(t){return t.postid===e.user.$key}),0!=e.arrayLastid){e.arrayLastItem=e.arrayLastid.slice(0),e.lastId=e.arrayLastItem[0].$key}}),console.log("ionViewDidLoad ViewpostPage"),this.active=!0,this.firebaseService.getLikePost().snapshotChanges().subscribe(function(t){e.arrayLikePosts=[],t.forEach(function(t){var n=t.payload.toJSON();n.$key=t.key,e.liked=n,e.arrayLikePosts.push(n)})}),this.firebaseService.getUser().snapshotChanges().subscribe(function(t){e.arrayUser=[];var n=t.payload.toJSON();n.$key=t.key,e.loginUser=n}),this.postComments=this.firebaseService.getMoreComments();this.postComments.snapshotChanges().subscribe(function(t){e.arrayComments=[],e.filteredArrayComments=[],t.forEach(function(t){var n=t.payload.toJSON();n.$key=t.key,e.arrayComments.push(n)}),e.filteredArrayComments=e.arrayComments,e.filteredArrayComments=e.arrayComments.filter(function(t){return t.postid==e.user.$key}),e.currentDate=(new Date).getTime()/1e3,e.filteredArrayComments.map(function(t){var n=t.time;e.commentsArray=[],e.users=t,e.currentDate-t.time<59?t.time=Math.round(e.currentDate-t.time)+"s":e.currentDate-t.time>59&&e.currentDate-t.time<3599?t.time=Math.round((e.currentDate-t.time)/60)+"m":e.currentDate-t.time>3599&&(t.time=Math.round((e.currentDate-t.time)/3600)+"h");e.firebaseService.getUsers(e.users.userid).snapshotChanges().subscribe(function(o){var i=o.payload.toJSON();i.$key=o.key,e.userProfile=i,e.commentObject={commentid:t.$key,postid:t.postid,userid:t.userid,comment:t.comment,image:e.userProfile.image,username:e.userProfile.username,time:t.time,color:!1,taggedText:"",originalTime:n};var s=e.commentObject.comment.indexOf("#");if(e.commentObject.comment.indexOf("#")>-1){e.taggedItem=!0;var r=e.commentObject.comment.indexOf(" ",s);e.taggedText=e.commentObject.comment.substring(s,r),e.commentObject.taggedText=e.taggedText}e.commentsArray.push(e.commentObject),e.commentsArray=e.commentsArray.reverse(),e.userId=e.firebaseService.userKey,e.boundClass={heart:e.heart},e.commentObject.color="not active";for(var a=0;a<e.arrayLikePosts.length;a++)e.arrayLikePosts[a].postid===e.commentObject.$key?e.arrayLikePosts[a].userid===e.firebaseService.userKey&&(e.commentObject.color="active"):console.log("no")})})})},e.prototype.ionViewDidEnter=function(){var e=this;this.currentDate=(new Date).getTime()/1e3,this.commentss=this.firebaseService.getMoreComments(this.limit);this.commentss.snapshotChanges().subscribe(function(t){e.arrayItems=[],t.forEach(function(t){var n=t.payload.toJSON();n.$key=t.key,e.arrayItems.push(n)}),e.arrayItems.map(function(t){e.currentDate-t.time>43200&&e.firebaseService.deleteComment(t.$key)})})},e.prototype.deletePost=function(e){var t=this;this.loadingCtrl.create({content:"Please wait..."}).present().then(function(n){t.firebaseService.deletePost(e.$key),t.firebaseService.getComments().snapshotChanges().subscribe(function(n){t.deleteCommentArray=[],n.forEach(function(e){var n=e.payload.toJSON();n.key=e.key,t.deleteCommentArray.push(n)}),t.deleteCommentArray=t.deleteCommentArray.filter(function(t){return t.postid==e.$key}),t.deleteCommentArray.map(function(e){t.firebaseService.deleteComment(e.key)})}),t.navCtrl.push("WallPage")})},e.prototype.deleteComment=function(e){var t=this;console.log(e.time),console.log(e.$key);var n=this.loadingCtrl.create({content:"Please wait..."});n.present().then(function(n){t.firebaseService.deleteComment(e.commentid),t.firebaseService.deleteAlert((1e3*e.originalTime).toString()+t.firebaseService.userKey),t.postComments=t.firebaseService.getComments();t.postComments.snapshotChanges().subscribe(function(e){t.arrayComments=[],t.filteredArrayComments=[],e.forEach(function(e){var n=e.payload.toJSON();n.$key=e.key,t.arrayComments.push(n)})});t.firebaseService.getSinglePost(e.postid).snapshotChanges().subscribe(function(n){console.log(n),t.arraySinglePost=[];var o=n.payload.toJSON();o.$key=n.key,t.arrayComments=t.arrayComments.filter(function(t){return t.postid==e.postid}),o.comments=t.arrayComments.length,t.firebaseService.updatePost(o)})}),n.dismiss()},e.prototype.likePost=function(e){console.log(e);var t;if(t={userid:this.firebaseService.userKey,postid:e.$key,status:!0},"active"!=e.color)if(this.firebaseService.likePost(t),this.active=!0,t.postid===e.$key){if(t.userid===this.firebaseService.userKey){e.color="active",e.hearts+=1,this.firebaseService.usersObject.points+=1,this.firebaseService.updateUser2(this.firebaseService.usersObject),this.firebaseService.updatePost(e);var n={postid:e.$key,postuserid:e.userid,action:"md-heart",color:"active",status:!0,time:(new Date).getTime()/1e3,commentid:"",userid:this.firebaseService.userKey,image:this.firebaseService.userImage,username:this.firebaseService.userName,comment:"",message:"liked your post",post:e.content};this.firebaseService.alertCustomId(n)}}else console.log("no");else e.color="not active",this.firebaseService.deleteLikePost((e.$key+this.firebaseService.userKey).toString()),this.firebaseService.deleteAlert(e.$key+this.firebaseService.userKey),e.hearts-=1,this.firebaseService.updatePost(e)},e.prototype.signOut=function(){console.log("Logged Out"),this.viewCtrl.dismiss(),this.firebaseService.logout(),this.app.getRootNav().push("LoginFlatPage"),localStorage.removeItem("userId")},e.prototype.textLength=function(e){this.textLeft=250-e.length},e.prototype.handleSelection=function(e){this.message=this.message+" "+e.char},e.prototype.closePost=function(){this.viewCtrl.dismiss()},e.prototype.commentPost=function(e){var t=this,n=this.loadingCtrl.create({content:"Please wait..."});n.present().then(function(n){e.postid=t.user.$key,e.userid=t.firebaseService.userKey,e.time=(new Date).getTime()/1e3,t.firebaseService.comment(e);var o={postid:t.user.$key,postuserid:t.user.userid,action:"md-chatbubbles",color:"activecomment",status:!0,time:(new Date).getTime()/1e3,commentid:"",userid:t.firebaseService.userKey,image:t.firebaseService.userImage,username:t.firebaseService.userName,comment:"",message:"commented on your post",post:e.comment};t.firebaseService.alertCustomId2(o),t.postComments=t.firebaseService.getComments();t.postComments.snapshotChanges().subscribe(function(e){t.arrayComments=[],t.filteredArrayComments=[],e.forEach(function(e){var n=e.payload.toJSON();n.$key=e.key,t.arrayComments.push(n)})});t.updatePost(e)}),n.dismiss()},e.prototype.updatePost=function(e){var t=this;this.firebaseService.getSinglePost(e.postid).snapshotChanges().subscribe(function(n){if(null!=n.key){t.arraySinglePost=[];var o=n.payload.toJSON();o.$key=n.key,t.arrayComments=t.arrayComments.filter(function(t){return t.postid==e.postid}),o.comments=t.arrayComments.length,t.firebaseService.usersObject.points+=1,t.firebaseService.updateUser2(t.firebaseService.usersObject),t.firebaseService.updatePost(o)}})},e.prototype.navTag=function(){var e=this,t=this.modalCtrl.create("TagboardPage");t.onDidDismiss(function(t){t&&(t.name=t.name.replace(/ +/g,""),e.comment.comment=e.comment.comment+" #"+t.name.toLowerCase()+" ")}),t.present()},e.prototype.loadMore=function(e){var t=this;this.limit+=50,setTimeout(function(){t.ionViewDidLoad(),console.log("Async operation has ended"),e.complete()},1e3)},e=r([Object(o.Component)({selector:"page-viewpost",template:'\x3c!--\n  Generated template for the ViewpostPage page.\n\n  See http://ionicframework.com/docs/components/#navigation for more info on\n  Ionic pages and navigation.\n--\x3e\n<ion-header>\n\n  <ion-toolbar>\n\n    <ion-buttons class="button">\n      <button (click)="closePost()" ion-button icon-only menuToggle>\n        <ion-icon class="icon-color2" name="md-close"></ion-icon>\n      </button>\n    </ion-buttons>\n\n    <ion-buttons start>\n      <button (click)="signOut()" ion-button icon-only>\n        <ion-icon name="ios-exit"></ion-icon>\n      </button>\n    </ion-buttons>\n  </ion-toolbar>\n\n</ion-header>\n\n<ion-content class="background-image" no-padding>\n  <div class="bg-color bg-size">\n    \x3c!-- <ion-row>\n      <ion-col> <button (click)="closePost()" ion-button icon-only menuToggle>\n          <ion-icon class="icon-color" name="md-close"></ion-icon>\n        </button>\n      </ion-col>\n    </ion-row> --\x3e\n    <ion-card no-padding>\n      <ion-row>\n        \x3c!-- <ion-col col-1> --\x3e\n        <ion-item>\n          <ion-avatar item-left>\n            <img *ngIf="user.image!=\'\'" [src]="user.image" [alt]="user.username" class="avatar" />\n            <img *ngIf="user.image==\'\'" [alt]="user.username" src="assets/images/blue-bird-with-green.png" class="avatar" width="60"\n              height="60">\n          </ion-avatar>\n        </ion-item>\n        \x3c!-- </ion-col> --\x3e\n        <ion-col align-self-start>\n          <ion-card-header>\n            <span class="user-name"> {{user.username}} </span> <span class="time"> - {{user.time}}</span>\n          </ion-card-header>\n          <ion-card-content class="posts">\n            {{user.content}} <span *ngIf="user.content.indexOf(\'#\') > -1" class="tag-color">{{user.taggedText}}</span>\n          </ion-card-content>\n        </ion-col>\n      </ion-row>\n      <ion-row>\n        <ion-col>\n          <button ion-button icon-left clear small color="light" (click)="likePost(user)">\n            <ion-icon name="md-heart" [ngClass]="{\'heart\':user.color===\'active\'}" class="icon-color"></ion-icon>\n            <div class="icon-num">{{user.hearts}}</div>\n          </button>\n        </ion-col>\n        <ion-col center text-center>\n          <button ion-button icon-left clear small color="light" (click)="deletePost(user)">\n            <ion-icon name="md-trash" class="icon-color"></ion-icon>\n          </button>\n        </ion-col>\n      </ion-row>\n    </ion-card>\n    <ion-card class="card-color">\n      <ion-row>\n        <ion-col>\n          <img *ngIf="loginUser.image!=\'\'" [src]="loginUser.image" class="avatar" />\n          <img *ngIf="loginUser.image==\'\'" [alt]="loginUser.username" src="assets/images/blue-bird-with-green.png" class="avatar" width="60"\n            height="60">\n        </ion-col>\n      </ion-row>\n      <ion-card-content>\n        <form margin-top>\n          <div input-field>\n            <ion-item no-padding class="item-color">\n              <ion-textarea maxLength="250" class="text-input" type="text" placeholder="Comment on post" [(ngModel)]="comment.comment"\n                [ngModelOptions]="{standalone: true}" (ngModelChange)="textLength($event)"></ion-textarea>\n            </ion-item>\n          </div>\n          <ion-row>\n            <ion-col>\n              <button item-left class="tag" ion-button small (click)="navTag()">\n                Tag It?\n              </button>\n            </ion-col>\n            <ion-col center text-center>\n              <span item-left class="icon-num2"> {{textLeft}} </span>\n              <button ion-button medium (click)="commentPost(comment)" color="secondary">\n                Comment\n              </button>\n            </ion-col>\n          </ion-row>\n        </form>\n      </ion-card-content>\n    </ion-card>\n    <div class="comment">\n      COMMENTS\n    </div>\n    <ion-content no-scroll>\n      <ion-card [virtualScroll]="commentsArray" [virtualTrackBy]="trackByName">\n        <ion-row *virtualItem="let comment">\n          <ion-col col-3>\n\n          </ion-col>\n          <ion-col align-self-start>\n            <ion-card-header>\n              <ion-item class="col-align">\n                <ion-avatar item-left>\n                  <img *ngIf="comment.image!=\'\'" [src]="comment.image" [alt]="comment.username" class="avatar" />\n                  <img *ngIf="comment.image==\'\'" [alt]="comment.username" src="assets/images/blue-bird-with-green.png" class="avatar" width="60"\n                    height="60">\n                </ion-avatar>\n              </ion-item>\n              <span class="user-name"> {{comment.username}} </span> <span class="time"> - {{comment.time}} </span>\n              <button *ngIf="comment.userid==userId" ion-button icon-left class="trash-align" clear small color="light" (click)="deleteComment(comment)">\n                <ion-icon name="md-trash" class="icon-color"></ion-icon>\n              </button>\n            </ion-card-header>\n            <ion-card-content class="posts">\n              {{comment.comment}} <span *ngIf="comment.comment.indexOf(\'#\') > -1" class="tag-color">{{comment.taggedText}}</span>\n              <hr class="divide-line">\n            </ion-card-content>\n          </ion-col>\n        </ion-row>\n      </ion-card>\n    </ion-content>\n\n  </div>\n</ion-content>'}),a("design:paramtypes",[i.q,i.d,i.o,s.a,i.p,i.r,i.x])],e)}()}});